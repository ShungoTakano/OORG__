# ブラウザゲーム要件定義書 (requirement.md)

## 1. プロジェクト概要
### 1.1. 目的
サークル引退にあたり、後輩たちへのメッセージやサークルの思い出をゲーム形式で伝える。引退日（明日）にURLを共有し、その場でプレイ、あるいは持ち帰ってプレイしてもらう。

### 1.2. ターゲット
サークルの後輩（現役部員）。

### 1.3. デプロイ環境
* **プラットフォーム:** Webブラウザ（PC / スマートフォン両対応）
* **ホスティング:** GitHub Pages
* **URL配布方法:** QRコードまたはLINE/Discord等でのリンク共有

## 2. システム要件
### 2.1. 技術スタック
* **言語:** HTML5, CSS3, JavaScript (Vanilla JS 推奨)
* **データ保存:** Web Storage API (`localStorage`) を使用して進行度を保存。
* **アセット管理:** 画像ファイルは `assets/images/` 等のディレクトリで管理。

### 2.2. パフォーマンス要件
* GitHub Pagesでのホスティングに適した軽量な構成。
* 初回ロード時間を短縮するため、画像アセットは圧縮して使用する。

## 3. 機能要件
### 3.1. ゲーム進行機能
* **形式:** アンダーテール風テキストアドベンチャー
    * 画面下部にメッセージウィンドウを表示。
    * クリック/タップでテキストを送り、ストーリーを進行させる。
    * 会話による進行をメインとし、要所でミニゲームを挟む。
* **分岐:** エンディング分岐あり（3種類）。各企画の成功/失敗がフラグとして管理される。

### 3.2. セーブ・ロード機能（キャッシュ機能）
* **オートセーブ:**
    * テキスト進行ごとに現在のシナリオインデックスを `localStorage` に自動保存。
    * 各ミニゲームの成功/失敗フラグも保存。
* **コンティニュー:**
    * ページロード時に `localStorage` を確認。データが存在する場合、「最初から」「続きから」を選択するダイアログを表示。

### 3.3. フラグ管理システム
* **ゲーム状態管理:**
```javascript
gameState = {
    currentScene: "intro",      // 現在のシーン
    busHikeClear: false,        // バスハイク成功フラグ
    summerEventClear: false,    // 夏企画成功フラグ
    tsudanumaFestClear: false,  // 津田沼祭成功フラグ
    skiSnowClear: false,        // スキスノ成功フラグ
    takanoHP: 100,              // 高野のHP
    takanoDefense: 5,           // 高野の防御力（引退選択で減少）
    retireCount: 0              // 「引退」選択回数
}
```
* **エンディング判定ロジック:**
    * `allClear = busHikeClear && summerEventClear && tsudanumaFestClear && skiSnowClear`
    * BAD: `!allClear` の状態で結末に到達
    * TRUE: `allClear && retireCount >= 5`
    * NORMAL: `allClear && takanoHP <= 0`

### 3.4. 演出機能
* **背景表示:** シーンIDに応じた背景画像の切り替え。
* **キャラ表示:** 発言者に合わせた立ち絵の表示/非表示/切り替え。
* **戦闘演出:** 弾幕パターン、ダメージエフェクト、心揺らぎ演出。

## 4. コンテンツ要件（プレイ時間：約30分）

### 4.1. ストーリー構成
**※以下、制作者にて記述すること**

#### 【導入パート】 (目安: 0分~5分)
* **シナリオ概要:**
    *プレイヤーは引退しまいそうでと足掻く先輩を引退に導く
    *ストーリーは"はしれメロス"のパロディで，プレイヤーはメロス役として，邪智暴虐の王"高野"にとらえられた"沖杉"を救う物語
    *高野は引退が惜しく，沖杉を人質にとって引退を阻止しようとしている
    *プレイヤーは先輩を引退に導くため，沖杉を救出し，引退させなければならない
    *高野は沖杉の開放条件として，1年前にタイムスリップし，企画の問題を阻止してこいと命じる
    *プレイヤーは去年の1月にタイムスリップし，"バスハイク"，"夏企画"，"津田沼祭"，"スキスノ"の4つのイベントで起きた問題を解決しなければならない

#### 【展開パート】 (目安: 5分~20分)
プレイヤーは1年前にタイムスリップし、4つの企画で発生した問題を順番に解決していく。
各企画には責任者がおり、その人物の問題をミニゲーム形式で解決する。

##### イベント1: バスハイク（責任者: 橋本）
* **問題:** 急遽参加者の班を組み直さなければならない
* **ミニゲーム:** 班分けパズル
    * 参加者を適切な班に振り分けるドラッグ＆ドロップ式パズル
    * 制限時間内に全員を配置できれば成功
    * 相性の悪い組み合わせを避けるなどの条件あり

##### イベント2: 夏企画（責任者: 丸山）
* **問題:** 尻尾取りに使う尻尾がなくなってしまった
* **ミニゲーム:** 推理形式の捜索ゲーム
    * 現場を調査し、証拠を集める
    * 容疑者への聞き込みで情報を収集
    * 最終的に正しい場所/犯人を指摘できれば成功

##### イベント3: 津田沼祭（責任者: 高橋）
* **問題:** 風に飛ばされたテントを修復しなければならない
* **ミニゲーム:** テント修復パズル
    * バラバラになったテントのパーツを正しい順序で組み立てる
    * タイミングよくボタンを押してポールを固定するQTE要素あり

##### イベント4: スキスノ（責任者: 渡邊）
* **問題:** ゲレンデでスマホをなくしてしまった
* **ミニゲーム:** スマホ捜索ゲーム
    * 広いゲレンデマップをスクロールして探索
    * ヒントを頼りにスマホの位置を特定
    * 制限時間内に見つければ成功

#### 【結末パート】 (目安: 20分~30分)
* **場面設定:** 全ての企画を終え、現代に帰還。高野の元へ向かう。
* **シナリオ概要:**
    * プレイヤーは高野と対峙し、引退を説得する
    * アンダーテール風の戦闘画面に移行
    * 「たたかう」「にげる」「引退」などのコマンドが選択可能
    * 高野は攻撃を仕掛けてくるが、プレイヤーは「引退」を選び続けることで説得できる

##### エンディング分岐（3種類）

**BADエンディング:**
* 条件: 4つの企画のうち1つでも問題を解決できなかった状態でエンディングを迎える
* 内容: 高野の引退を説得できず、サークルは混乱のまま終わる

**TRUEエンディング:**
* 条件: 全ての企画を成功させた上で、高野との戦闘で「引退」を選び続ける
* 内容: 高野は心を開き、無事に引退を受け入れる。感動的なエピローグ。

**NORMALエンディング:**
* 条件: 全ての企画を成功させたが、高野との戦闘で「たたかう」を選んで倒してしまう
* 内容: 高野は倒れたが、後味の悪い結末。引退はしたものの、わだかまりが残る。

### 4.2. ミニゲーム詳細仕様

#### ミニゲーム1: 班分けパズル（バスハイク）
* **UI:** 左側に参加者リスト、右側に班のスロット
* **操作:** ドラッグ＆ドロップで参加者を班に配置
* **クリア条件:** 制限時間（60秒）以内に全員を適切に配置
* **失敗条件:** 時間切れ、または相性の悪い組み合わせで確定

#### ミニゲーム2: 推理捜索（夏企画）
* **UI:** 現場画面と聞き込み画面の切り替え
* **操作:** クリックで調査、選択肢で質問
* **クリア条件:** 正しい場所を特定して尻尾を発見
* **失敗条件:** 3回間違えるとゲームオーバー

#### ミニゲーム3: テント修復（津田沼祭）
* **UI:** バラバラのテントパーツが表示された画面
* **操作:** 正しい順序でパーツをクリック、QTEでタイミング押し
* **クリア条件:** 全パーツを正しく組み立て、QTEを成功
* **失敗条件:** 順序を3回間違える、またはQTE失敗

#### ミニゲーム4: スマホ捜索（スキスノ）
* **UI:** スクロール可能なゲレンデマップ
* **操作:** スワイプ/ドラッグでマップ移動、タップで調査
* **クリア条件:** 制限時間（90秒）以内にスマホを発見
* **失敗条件:** 時間切れ

### 4.3. 戦闘システム（高野戦）
* **形式:** アンダーテール風ターン制バトル
* **UI構成:**
    * 上部: 高野のスプライトと台詞
    * 中央: 弾幕回避エリア（プレイヤーのハートを操作）
    * 下部: コマンド選択（たたかう / にげる / 引退）
* **戦闘フロー:**
    1. プレイヤーがコマンドを選択
    2. 高野の攻撃（弾幕パターン）を回避
    3. 繰り返し
* **「引退」コマンド:**
    * 選択するたびに高野の防御力が下がる（心が揺らぐ演出）
    * 一定回数（5回）選び続けるとTRUEエンディングへ
* **「たたかう」コマンド:**
    * 高野にダメージを与える
    * HPを0にするとNORMALエンディングへ

### 4.4. アセット要件
* **背景画像:**
    * 導入: 高野の城（？）、タイムスリップ演出
    * バスハイク: バス内、集合場所
    * 夏企画: 活動場所、調査現場
    * 津田沼祭: 学園祭会場、テント設営場所
    * スキスノ: ゲレンデ、スキー場
    * 結末: 戦闘画面背景
* **キャラクター:**
    * 高野（ボス・立ち絵＋戦闘スプライト）
    * 沖杉（人質・立ち絵）
    * 橋本（バスハイク責任者・立ち絵）
    * 丸山（夏企画責任者・立ち絵）
    * 高橋（津田沼祭責任者・立ち絵）
    * 渡邊（スキスノ責任者・立ち絵）
    * プレイヤー（ハートアイコン・戦闘用）
* **BGM/SE:** フリー素材（工数次第で省略可）
    * 通常BGM、戦闘BGM、各エンディングBGM

## 5. UI/UXデザイン
### 5.1. 画面構成
* **メイン画面:**
    * 背景レイヤー
    * キャラクターレイヤー
    * メッセージウィンドウ（下部固定、半透明背景）
* **テキスト表示:** 名前欄とメッセージ本文。

### 5.2. 操作系
* 全画面タップ：メッセージ送り
* 選択肢ボタン：分岐がある場合のみ画面中央にオーバーレイ表示

## 6. 開発スケジュール（緊急）
1.  **要件定義・シナリオ作成:** [完了]
2.  **アセット準備:** 写真撮影・素材収集
3.  **コーディング:** HTML/CSS/JSの実装
4.  **デプロイ:** GitHubへのPushとPages設定
5.  **テスト:** スマホ実機での動作確認
6.  **公開:** URL共有
